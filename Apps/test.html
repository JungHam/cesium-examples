<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>Hello World!</title>

  <script src="../Build/Cesium/Cesium.js"></script>
  <script src="jquery-3.1.1.js"></script>
  <script src="../MFOC/src/draw.js"></script>
  <script src="../MFOC/src/draw_indoor.js"></script>
  <script src="../MFOC/src/moving.js"></script>
  <script src="../MFOC/src/utility.js"></script>
  <script src="../MFOC/src/property.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>


  <style>

  @import url(../Build/Cesium/Widgets/widgets.css);
  html, body, #cesiumContainer {
    width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
  }
  @import url(Sandcastle/templates/bucket.css);

  table {
    color : white;
  }

  #name_list {
    cursor: pointer;
  }
  .graph{
    position : absolute;
    bottom : 0px;
    width : 100%; height : 0%;
    z-index:2;
  }
  </style>
</head>
<body style="margin-bottom:10px">
<iframe src="about:blank" id="iframe" sandbox="allow-same-origin"></iframe>
<div id="cesiumContainer" style="position:absolute; top:0px; z-index:1;"></div>

<div id="graph" class="graph" > </svg>

</body>

<script>

  viewer = new Cesium.Viewer('cesiumContainer');
  scene = viewer.scene;
  scene.primitives.destroyPrimitives = false;
  viewer.clock.shouldAnimate = false;
  var url = getParameterByName('url');
  var token = getParameterByName('token');

  Cesium.Viewer.prototype.clear = function(){
    this.clock.multiplier = 10;
    this.dataSources.removeAll();
    var temp = this.scene.primitives.get(0);
    this.entities.removeAll();
    this.scene.primitives.removeAll();
    this.scene.primitives.add(temp);
  }

  function linepath_test(){
    $.getJSON('json_data/polyline.json').then(
      function(data){
        var mf_arr = [];
        for (var i = 0 ; i < data.features.length; i++){
          mf_arr.push(data.features[i]);
        }
        var prim = drawLinesPath(mf_arr, true);
        scene.primitives.add(prim);
        scene.primitives.add(drawLines(mf_arr,true));
      }
    );
  }

  function property_test(){
    $.getJSON('json_data/polygon2015.json').then(
      function(data){

        document.getElementById('graph').style.height = '20%';
        document.getElementById('cesiumContainer').style.height = '80%';
        var pro_arr = [];
        for (var i = 0 ; i < data.features.length; i++){
          if (data.features[i].temporalProperties[0].name == 'central pressure')
            pro_arr.push(data.features[i].temporalProperties[0]);
        }

        showProperty(pro_arr, 'graph');

      }
    );

  }

  function point_test_2(id_arr){

    var mf_arr = [];
    var i = 0;
    var j = 0;

    var finish = 0;

    while (i < id_arr.length){
      $.getJSON(url + "/FeatureLayers('Typhoon1995')/"+id_arr[i]+"?token="+token).then(
        function(data){
          for (var j = 0 ; j < data.features.length ; j++){
            mf_arr.push(data.features[j]);
          }

          viewer.clear();
          scene.primitives.add(drawPointsPath(mf_arr, true));
          var czml = movePointArray(mf_arr , true);
          var load_czml = Cesium.CzmlDataSource.load(czml)
          viewer.dataSources.add(load_czml);
        }
      );
      i++;
    }
  }

  function point_test(){
    var id_arr = [];
    $.getJSON(url + "/FeatureLayers('Typhoon1995')/$ref").then(
      function(data){

        for (var i = 0 ; i < data.url.length ; i++){
          id_arr[i] = data.url[i];
          if (i == data.url.length -1){
            point_test_2(id_arr);

            console.log(scene.primitives);
          }
        }

      }
    );


  }


  function polygon_test(){
    $.getJSON('json_data/polygon2015.json').then(
      function(data){
        var mf_arr = [];
        for (var i = 0 ; i < data.features.length ; i++){
          mf_arr.push(data.features[i]);

        }
        scene.primitives.add(drawPolygons(mf_arr, true));

        var czml = movePolygonArray(mf_arr, 1);

        var load_czml = Cesium.CzmlDataSource.load(czml)
        viewer.dataSources.add(load_czml);

      }
    );

  }

  function point_indoor_test(){
    $.getJSON('json_data/indoor.json').then(
      function(data){
        var mf_arr = [];
        for (var i = 0 ; i < data.features.length ; i++){
          mf_arr.push(data.features[i]);
        }
        scene.primitives.add(drawPointsWithZvalue(mf_arr, true));
      }
    );

  }
  point_indoor_test();
  //property_test();
  //point_test();
  //polygon_test();

</script>


</html>
